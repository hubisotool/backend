Backend
=======

Provides access to nodejs and os level interactions for the hubiso tool 

## Installation

To install the latest version of backend

```javascript
$ npm install --save https://bitbucket.org/hubisotool/backend/get/master.tar.gz
```

To install version x.x.x of backend

```javascript
$ npm install --save https://bitbucket.org/hubisotool/backend/get/x.x.x.tar.gz
```

NB: Whereas master.tar.gz contains the latest build of backend, x.x.x.tar.gz contains a stable build of backend

## API

Summary of the API : 

1. Startup
2. Shutdown
3. Creating an alert.
4. Loading data from db.

### 1. Startup

Some configuration parameters need to be passed to the backend to have a smooth running application.
* \*datapath : 
Path to a folder where all files for the backend will be kept.

all \* parameters are mandatory
```javascript
var b = require("backend");

var opts = {
    // Get Local Data location from Node Webkit application
   datapath = require('nw.gui').App.dataPath
}

// Start the backend
b.startup(opts)
```

### 2 Shutdown

Do not forget to shutdown the backend on application quit in order to release resources.
Otherwise the application may not close successfully, and hence **may not show a window** on next invocation.

```javascript
var b = require("backend");

// Shutdown the backend
b.shutdown()
```

### 3 Creating an alert

```javascript
var b = require("backend");

// Create a simple alert with title and message
b.alert({ title : "Test alert", text : "This is a test alert generated by Bishaka Samuel"});
```

### 4 Loading data from db

The backend uses [nedb](https://github.com/louischatriot/nedb) as it's database engine. 
For maximum flexibility, loading data from the db takes 3 paramaters :
* dbname :
The name of the db you would like to load data from.

* func:
The [nedb](https://github.com/louischatriot/nedb) function you would like to execute on that db. Technically, the function list is not limited to only data load functions.. so ideally any valid [nedb](https://github.com/louischatriot/nedb) function can be passed to this parameter.

* opts:
The options you would like to pass to the function being exectuted. The validity is determined by the [nedb](https://github.com/louischatriot/nedb) spec of the function you are executing.

Example:

1 Loading all alerts from the db

```javascript
var b = require("backend");

var dbname = "alerts";
var func = "find"; // nedb Spec at https://github.com/louischatriot/nedb#basic-querying
var opts = {};

b.loadFromDb(dbname,func,opts)
.then(function(alerts){
    console.log(alerts) // The alerts object contains all entries in the alerts db
})
```

2 Loading alerts(Filtering by source) from the db

```javascript
var b = require("backend");

var dbname = "alerts";
var func = "find"; // nedb Spec at https://github.com/louischatriot/nedb#basic-querying
var opts = {src:"Test Module 1"};

b.loadFromDb(dbname,func,opts)
.then(function(alerts){
    console.log(alerts) // The alerts object contains all entries in the alerts db
})
```

3 Loading alerts(Filtering by source) from the db using generic execInDb function

```javascript
var b = require("backend");

var dbname = "alerts";
var func = "find"; // nedb Spec at https://github.com/louischatriot/nedb#basic-querying
var args = [{src:"Test Module 1"}]; // Pay attention, here args is an array literal of arguments passed to the above function

b.execInDb(dbname,func,args)
.then(function(alerts){
    console.log(alerts) // The alerts object contains all entries in the alerts db
})
```
